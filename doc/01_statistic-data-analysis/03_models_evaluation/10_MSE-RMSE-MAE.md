# 10. MSE・RMSE・MAE

# もくじ
- [10. MSE・RMSE・MAE](#10-msermsemae)
- [もくじ](#もくじ)
- [0. はじめに](#0-はじめに)
- [1. 単純差分を把握する](#1-単純差分を把握する)
  - [1.1. 平均誤差（ME）](#11-平均誤差me)
  - [1.2. 平均誤差率（MPE）](#12-平均誤差率mpe)
- [2. 絶対値を把握する](#2-絶対値を把握する)
  - [2.1. MAE](#21-mae)
  - [2.2. ****平均二乗誤差 （MSE）****](#22-平均二乗誤差-mse)
  - [2.3. 平均絶対誤差率（MAPE）](#23-平均絶対誤差率mape)
- [3. 二乗誤差を把握する](#3-二乗誤差を把握する)
  - [3.1. ****二乗平均平方根誤差（RMSE）****](#31-二乗平均平方根誤差rmse)
  - [3.2. 平均平方二乗誤差率（RMSPE）](#32-平均平方二乗誤差率rmspe)
- [4. 誤差指標の選び方](#4-誤差指標の選び方)
  - [4.1. どういった誤差が現れるか](#41-どういった誤差が現れるか)
  - [4.2. 数値のばらつきは大きいか](#42-数値のばらつきは大きいか)
- [99. 参考](#99-参考)

# 0. はじめに

ここでは、以下マトリックスのように、単純差分・絶対値・二乗誤差の観点でデータ内の誤差を確認する方法について触れていきます。

- 各手法のマトリックス

|  | 単純誤差 | 絶対値 | 二乗誤差 |
| --- | --- | --- | --- |
| 誤差 | ME | MAE | RMSE |
| 誤差率 | MPE | MAPE | RMSPE |

# 1. 単純差分を把握する

## 1.1. 平均誤差（ME）

全データの「正解値-予測値」の平均をとります。

$$
ME=\frac{1}{n}\sum_{i=1}^{n} (y_i-\hat{y_i})
$$

## 1.2. 平均誤差率（MPE）

MAPEは「Mean Absolute Percentage Error」の略で、全データの「正解値-予測値」を正解値で割った値の絶対値の平均をとります。

$$
MAPE=\frac{1}{n}\sum_{i=1}^{n} \Bigl|\frac{y_i-\hat{y_i}}{y_i}\Bigl|
$$

# 2. 絶対値を把握する

## 2.1. MAE

MAE（Mean Absolute Error/平均絶対値誤差）は、**真の値と予測値の差の絶対値を平均したもの**です。

いわば真の値と予測値のズレを表現しているものなので、外れ値の影響を低減した形での評価に適しています。

MAEを使用するケースとして、全サンプルの**誤差を平等に評価**し、サンプル全体の誤差をできるだけ小さくしたい場合に利用します。さらにMAEはRMSEに比べ外れ値や誤差に影響されにくいと言われています。

$$
\mathrm{MAE}=\dfrac{1}{n}\displaystyle\sum_{i=1}^n|\hat{y_i}-y_i|
$$

Python で書くと以下のようになります。

```python
from sklearn.metrics import mean_absolute_error
mean_absolute_error(true, pred)
```

## 2.2. ****平均二乗誤差 （MSE）****

平均二乗誤差 (MSE=Mean Squared Error)とは、それぞれのデータに対して、実際の値と予測値の差の2乗を計算し、その総和をとり、データの総数で割った値です。

平均二乗誤差 (MSE)では、**値が小さいほど誤差の少ないモデル**と言えます。

$$
\mathrm{MSE}=\dfrac{1}{n}\displaystyle\sum_{i=1}^n(\hat{y_i}-y_i)^2
$$

分散のような形をしています。

## 2.3. 平均絶対誤差率（MAPE）

MAPE（Mean Absolute Percentage Error/平均絶対誤差率）とは、各データに対して「予測値と正解値との差を正解値で割った値の絶対値を計算し、その総和をデータ数で割った指標です。

MAEでは絶対値の差で比較したが、MAPEでは**±○○パーセントズレの平均**で求めます。

**異なるスケール間での誤差を比較できます。**

$$
{\dfrac {100}{N}\sum ^{N}_{i=1}\left| \frac{ \widehat {y_{i}}-y_{i} }{y_{i}}\right|
}
$$

Python で書くと以下のようになります。

```python
import numpy as np
np.mean(np.abs((pred - true) / true)) * 100
```

# 3. 二乗誤差を把握する

## 3.1. ****二乗平均平方根誤差（RMSE）****

二乗平均平方根誤差(RMSE=Root Mean Squared Error) とは、MSEに平方根をとることで計算されるものです。

二乗したことの影響を、平方根で補正しています。

**この値が小さければ小さいほど**、誤差の小さいモデルであると言えます。数式では二乗平均平方根誤差は以下のように表せます。

$$
\mathrm{RMSE}=\displaystyle\sqrt{\dfrac{1}{n}\sum_{i=1}^n(\hat{y_i}
-y_i)^2}
$$

Python で書くと以下のようになります。

```python
import numpy as np
from sklearn.metrics import mean_squared_error
np.sqrt(mean_squared_error(true, pred))
```

## 3.2. 平均平方二乗誤差率（RMSPE）

RMSPE（Root Mean Squared Percentage Error/平均平方二乗誤差率）とは、全データの「正解値-予測値」を正解値で割った値の2乗の平均を計算し、最後に平方根を取ったものです。

誤差の影響を大きく反映し、かつ異なるスケール間の誤差を比較できる特徴があります。

$$
{100\left(\dfrac {1}{N}\sum ^{N}_{i=1}\left( \frac{\widehat {y_{i}}- y_{i} }{y_{i}}\right)^2\right)^{\frac{1}{2}} 
}
$$

Python で書くと以下のようになります。

```python
import numpy as np
np.sqrt(np.mean(((pred - true) / true)**2))*100
```

# 4. 誤差指標の選び方

以下観点で各誤差指標を選んでいきます。

## 4.1. どういった誤差が現れるか

まずは、誤差をどう評価したいかについて、以下の方針で検討します。

- **「予測より大きく間違えたか、小さく間違えたかで評価が変わる」場合**
    - プラスマイナス関係を損なわない”**単純差分”**の誤差を選んだ方が良い
    - 間違いがマイナスにぶれているのか、プラスにぶれているのかが一目瞭然になります。
- **「誤差が大きいほどペナルティを大きくしたい」場合**
    - “**2乗誤差”**を選んだ方が良い
    - 誤差を2乗することにより、誤差が大きければ大きいほどそのペナルティも大きくなります。
- **どちらにも当てはまらない場合**
    - **“絶対値”**の誤差を選んだ方が良い
    - どれほど正解とずれているのか数値を見ただけで分かります。

これらの選択が難しい場合、標準偏差の計算と似ているためか**2乗誤差**が好まれます。

## 4.2. 数値のばらつきは大きいか

予測値の分布が小さいと考えられるのか、それとも1だったり100だったりするような幅広い数値となるのかを確認します。

例えば、正解が10で9と予測した場合、誤差は1です。正解が100で90と予測した場合、誤差は10になってしまいます。しかし、割合で見ればどちらも同じだけの差になります。

誤差を単純に足し合わせていくだけだと、正解値が大きいものの誤差に全体が引っ張られてしまうため、それが相応しくない場合は**”誤差率”**の方を使うべきです。

# 99. 参考

[予測精度評価指標をPythonで実装する - Qiita](https://qiita.com/23tk/items/2dbb930242eddcbb75fb)

[https://www.notion.so](https://www.notion.so)